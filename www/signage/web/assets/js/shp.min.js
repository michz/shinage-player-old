"use strict";function ImageSlide(){this.type="Image",this.title="",this.duration=1e3,this.transition="",this.src="",this.markup=null,this.onComplete=null,this.configure=function(t){this.src=t.src},this.init=function(){return this.markup=$(this.getMarkup()),this.markup},this.getMarkup=function(){return'<div class="slide image"><img src="'+this.src+'"></div>'},this.show=function(){this.markup.css("opacity",1)},this.hide=function(){this.markup.css("opacity",0)}}function Keyboard(t,i){i=i||{},this.presentation=t,$(document).keydown($.proxy(function(t){39==t.which?this.keyRight():37==t.which?this.keyLeft():27==t.which&&this.keyEsc()},this)),this.keyRight=function(){this.presentation&&this.presentation.nextSlide()},this.keyLeft=function(){this.presentation&&this.presentation.prevSlide()},this.keyEsc=function(){this.presentation&&this.presentation.pause()}}function Presentation(){this.container=null,this.slides=[],this.slideCount=0,this.currentSlideId=-1,this.currentNextSlideHandler=null,this.load=function(t){void 0!=t.slides&&this.loadSlides(t.slides),void 0!=t.settings&&this.loadSettings(t.settings)},this.loadSlides=function(t){this.slides=[],this.slideCount=0;for(var i=new SlideFactory,e=0;e<t.length;e++){var s=t[e],n=i.createSlide(s),r=n.init();this.container.append(r),this.slides.push(n),this.slideCount+=1}this.nextSlide()},this.loadSettings=function(t){void 0!=t.backgroundColor&&$("body").css("background-color",t.backgroundColor)},this.showSlide=function(t){var i=this.getSlide(t);this.hideSlide(),i.show(),this.currentSlideId=t},this.nextSlide=function(){var t=this.currentSlideId+1;t>=this.slideCount&&(t=0),this.gotoSlide(t)},this.prevSlide=function(){var t=this.currentSlideId-1;t<0&&(t=this.slideCount-1),this.gotoSlide(t)},this.gotoSlide=function(t){null!=this.currentNextSlideHandler&&clearTimeout(this.currentNextSlideHandler),this.showSlide(t);var i=this.getSlide(t);i.onComplete=$.proxy(this.nextSlide,this),i.duration>0&&(this.currentNextSlideHandler=setTimeout($.proxy(this.nextSlide,this),i.duration))},this.hideSlide=function(){var t=this.getCurrentSlide();null!=t&&t.hide()},this.pause=function(){null!=this.currentNextSlideHandler&&clearTimeout(this.currentNextSlideHandler)},this.getSlide=function(t){return this.slides[t]},this.getCurrentSlide=function(){return this.currentSlideId<0||this.currentSlideId>=this.slideCount?null:this.slides[this.currentSlideId]}}function PresentationLoader(){this.currentUrl="",this.currentLastModified=0,this.recheckTimeout=6e4,this.check=function(){$.ajax("/current",{method:"get",dataType:"jsonp",success:$.proxy(function(t){void 0!=t.lastModified&&void 0!=t.url&&(this.currentUrl==t.url&&this.currentLastModified==t.lastModified||(this.currentUrl=t.url,this.currentLastModified=t.lastModified,this.load(this.currentUrl)))},this)}),setTimeout($.proxy(this.check,this),this.recheckTimeout)},this.load=function(t){$.ajax(t,{method:"get",dataType:"jsonp",success:$.proxy(function(t){this.clear();var i=new Presentation;keyboardHandler.presentation=i,i.container=$("#canvas"),i.load(t)},this)})},this.clear=function(){$("#canvas").empty()}}function SlideFactory(){this.createSlide=function(t){var i=t.type+"Slide",e=new window[i];return e.duration=t.duration,e.title=t.title,e.transition=t.transition,e.configure(t),e}}function VideoSlide(){this.type="Video",this.title="",this.duration=1e3,this.transition="",this.src="",this.mime="",this.markup=null,this.videoElement=null,this.onComplete=null,this.configure=function(t){this.src=t.src},this.init=function(){return this.markup=$(this.getMarkup()),this.videoElement=this.markup.find("video").get(0),this.videoElement.addEventListener("ended",$.proxy(this.onCompleteHandler,this),!1),this.videoElement.width=$(window).width(),this.videoElement.height=$(window).height(),this.markup},this.getMarkup=function(){return'<div class="slide video">   <video>       <source src="'+this.src+'" type="'+this.mime+'">   </video></div>'},this.show=function(){this.markup.css("opacity",1),this.videoElement.currentTime=0,this.videoElement.play()},this.hide=function(){this.videoElement.pause(),this.markup.css("opacity",0)},this.onCompleteHandler=function(){null!=this.onComplete&&this.onComplete()}}function WebSlide(){this.type="Web",this.title="",this.duration=0,this.transition="",this.src="",this.markup=null,this.onComplete=null,this.configure=function(t){this.src=t.src},this.init=function(){return this.markup=$(this.getMarkup()),this.markup},this.getMarkup=function(){return'<div class="slide web"><iframe src="'+this.src+'"></iframe></div>'},this.show=function(){this.markup.css("opacity",1)},this.hide=function(){this.markup.css("opacity",0)}}